# Feature Detection Crate - AI Assistant Guide

## CardFeature検出パターンの重要事項

### 正規表現パターンと記号の関係
このクレートは、カードテキストから特定のパターンを検出してCardFeatureを識別します。
**正規表現パターンは特定の記号に依存しています**。

### 必須記号と対応する機能
1. **`【】` brackets**:
   - 能力名の検出: `【アサシン】`, `【チャーム】`, `【ランサー】`など
   - ライフバースト: `【ライフバースト】`
   - 能力タイプ: `【常】`, `【出】`, `【起】`, `【自】`

2. **`《》` brackets**:
   - アイコン検出: `《ガードアイコン》`, `《アクセアイコン》`
   - ゲームメカニック: `《クラフト》`, `《ビートアイコン》`
   - 色マーカー: `《白》`, `《赤》`, `《青》`, `《緑》`, `《黒》`

3. **`:` colons**:
   - タイミング指定: `出：`, `自：`, `起：`, `常：`
   - 能力の区切り文字として機能

### 検出パターンの実装詳細
`lib.rs`の`create_detect_patterns()`関数で定義されている主要パターン：

```rust
// 例: ガードアイコンの検出
DetectPattern {
    pattern: Regex::new(r"《ガードアイコン》").unwrap(),
    features: vec![CardFeature::GuardIcon],
}

// 例: アサシン能力の検出
DetectPattern {
    pattern: Regex::new(r"【アサシン】").unwrap(),
    features: vec![CardFeature::Assassin],
}
```

### 半角化処理との連携
1. **重要**: `to_half()`関数は全角英数字のみを変換
2. **記号は保持**: `【】`, `《》`, `：`（全角コロン）は変換されない
3. **注意**: 全角コロン`：`と半角コロン`:`は異なる - パターンは両方に対応

### トラブルシューティング
CardFeatureが検出されない場合のチェックリスト：

1. **入力テキストの確認**:
   - RawCardのskill_text/life_burst_textに記号が含まれているか
   - HTMLからの抽出時に記号が保持されているか

2. **正規表現パターンの確認**:
   - パターンが正しい記号を使用しているか
   - 全角/半角の違いに注意

3. **テストデータ**:
   - 実際のカードHTMLから抽出したテキストでテスト
   - 手動で作成したテストデータは記号を正確に含める

### パターン追加時の注意
新しいCardFeatureを追加する際：
1. 実際のカードテキストから記号をコピー
2. 全角/半角の混在に注意
3. 必ず実データでテストを実施