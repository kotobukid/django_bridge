[config]
default_to_workspace = false

[tasks.manage]
description = "Run Django manage.py commands from the Rust project root"
args = ["./table_definition/manage.py", "${@}"]
command = "python"

[tasks.syncdb]
description = "Run syncdb binary"
command = "cargo"
env = { "CARGO_MANIFEST_DIR" = "${CARGO_MAKE_WORKSPACE_WORKING_DIRECTORY}/webapp" }
args = [
    "run",
    "--package",
    "syncdb"
]

[tasks.generate]
description = "Run npm run generate in the ./front Nuxt.js project"
cwd = "./front"
command = "npm"
args = ["run", "generate"]

[tasks.wasm]
#description = "build wasm by wasm-pack (debug build) and organize files"
#script = [
#    "mkdir -p ./front/static/pkg",
#    "cd datapack && wasm-pack build --target web --out-dir ../front/public/pkg",
#    "mv ./front/public/pkg/datapack.d.ts ./front/static/pkg/datapack.d.ts",
#    "mv ./front/public/pkg/datapack.js ./front/static/pkg/datapack.js",
#    "mv ./front/public/pkg/datapack_bg.wasm.d.ts ./front/static/pkg/datapack_bg.wasm.d.ts",
#    "mv ./front/public/pkg/package.json ./front/static/pkg/package.json"
#]
#
#[tasks.wasm2]
#description = "build wasm by wasm-pack (debug build) and organize files"
#script = '''
#bash -c "
#mkdir -p ./front/static/pkg
#cd datapack
#wasm-pack build --target web --out-dir ../front/public/pkg
#cd ..
#mv ./front/public/pkg/datapack.d.ts ./front/static/pkg/datapack.d.ts
#mv ./front/public/pkg/datapack.js ./front/static/pkg/datapack.js
#mv ./front/public/pkg/datapack_bg.wasm.d.ts ./front/static/pkg/datapack_bg.wasm.d.ts
#mv ./front/public/pkg/package.json ./front/static/pkg/package.json
#"
#'''
#
#
#[tasks.wasm3]
description = "build wasm by wasm-pack (debug build) and organize files"
script = '''
mkdir front\\static\\pkg >nul 2>&1
cd datapack && wasm-pack build --target web --out-dir ..\\front\\public\\pkg && cd ..
move /Y front\\public\\pkg\\datapack.d.ts front\\static\\pkg\\datapack.d.ts
move /Y front\\public\\pkg\\datapack.js front\\static\\pkg\\datapack.js
move /Y front\\public\\pkg\\datapack_bg.wasm.d.ts front\\static\\pkg\\datapack_bg.wasm.d.ts
move /Y front\\public\\pkg\\package.json front\\static\\pkg\\package.json
copy /Y front\\public\\pkg\\.gitignore front\\static\\pkg\\.gitignore
'''